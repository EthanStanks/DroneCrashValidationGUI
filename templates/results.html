<!DOCTYPE html>
<html>
<head>
    <title>Streaming Video</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
<div class="container">
    <h1>Video Stream - Mark Crashes</h1>

    <div class="video-container">
        <img id="video" src="{{ url_for('video_feed') }}" width="640" height="360" />
    </div>

    <!-- Crash & Pause Buttons -->
    <button id="crashBtn">Mark Crash</button>
    <button id="pauseBtn">Pause</button>

    <!-- Crash count display -->
    <p id="crashCountDisplay">Total Crashes: 0</p>
</div>

<script>
let paused = false;

// Crash button logic
document.getElementById('crashBtn').addEventListener('click', function() {
    // Only mark crash if not paused
    if (!paused) {
        fetch('/mark_crash', { method: 'POST' })
            .then(() => {
                // after marking crash, fetch the new count
                fetch('/get_crash_count')
                    .then(r => r.text())
                    .then(count => {
                        document.getElementById('crashCountDisplay').innerText = 
                            "Total Crashes: " + count;
                    });
            });
    }
});

// Pause/Resume button
document.getElementById('pauseBtn').addEventListener('click', function() {
    fetch('/toggle_pause', { method: 'POST' })
        .then(r => r.json())
        .then(data => {
            paused = data.paused; // true or false
            if (paused) {
                // System is now paused
                document.getElementById('pauseBtn').innerText = "Resume";
                // You could also disable crashBtn if you prefer
                document.getElementById('crashBtn').disabled = true;
            } else {
                // System is now resumed
                document.getElementById('pauseBtn').innerText = "Pause";
                document.getElementById('crashBtn').disabled = false;
            }
        });
});

// Poll every 2s for done status
setInterval(function() {
    fetch('/check_status')
        .then(r => r.text())
        .then(data => {
            if (data === "done") {
                window.location.href = "/final_results";
            }
        });
}, 2000);
</script>
</body>
</html>
